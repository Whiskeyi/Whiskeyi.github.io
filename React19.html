<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI" />
    <meta name="baidu-site-verification" content="093lY4ziMu" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="description" content="">
    <meta name="keyword"  content="">
    <link rel="shortcut icon" href="/img/ironman-draw.png">
    <!-- Place this tag in your head or just before your close body tag. -->
    <script async defer src="https://buttons.github.io/buttons.js"></script>
    <!--<link href='http://fonts.googleapis.com/css?family=Montserrat:400,700' rel='stylesheet' type='text/css'>-->
    <title>
        
          React升级之路！一文掌握React19新功能及React版本升级 - ZHUCHJ
        
    </title>

    <link rel="canonical" href="https://zhuchj.com/React19.html">

    <!-- Bootstrap Core CSS -->
    
<link rel="stylesheet" href="/css/bootstrap.min.css">


    <!-- Custom CSS --> 
    
        
<link rel="stylesheet" href="/css/dusign-light.css">

        
<link rel="stylesheet" href="/css/dusign-common-light.css">

        
<link rel="stylesheet" href="/css/font-awesome.css">

        
<link rel="stylesheet" href="/css/toc.css">

        <!-- background effects end -->
    
    
    <!-- Pygments Highlight CSS -->
    
<link rel="stylesheet" href="/css/highlight.css">


    
<link rel="stylesheet" href="/css/widget.css">


    
<link rel="stylesheet" href="/css/rocket.css">


    
<link rel="stylesheet" href="/css/signature.css">


    
<link rel="stylesheet" href="/css/fonts.googleapis.css">


    <link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.3.0/css/font-awesome.min.css">

    <!-- photography -->
    
<link rel="stylesheet" href="/css/photography.css">


    <!-- ga & ba script hoook -->
    <script></script>
<meta name="generator" content="Hexo 4.2.1"></head>


<!-- hack iOS CSS :active style -->
<body ontouchstart="">

    <!-- background effects start -->
    
    <!-- background effects end -->

	<!-- Post Header -->
<style type="text/css">
    header.intro-header{
        
            
                background-image: linear-gradient(rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.3)), url('img/react19/react19.png')
                /*post*/
            
        
    }
    
    #signature{
        background-image: url('/img/signature/dusign.png');
    }
    
</style>

<header class="intro-header" >
    <!-- Signature -->
    <div id="signature">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                
                    <div class="post-heading">
                        <div class="tags">
                            
                              <a class="tag" href="/tags/#React" title="React">React</a>
                            
                        </div>
                        <h1>React升级之路！一文掌握React19新功能及React版本升级</h1>
                        <h2 class="subheading">React19新功能及React版本升级</h2>
                        <span class="meta">
                            由 Whiskeyi 于
                            2024-10-26 发布
                        </span>

                        
                            <div class="blank_box"></div>
                            <span class="meta">
                                全文 <span class="post-count">6.2k</span> 字，
                                阅读约需 <span class="post-count">26</span> 分钟
                            </span>
                            <div class="blank_box"></div>
                            <!-- 不蒜子统计 start -->
                            <span class="meta">
                                浏览 <span id="busuanzi_value_page_pv"><i class="fa fa-spinner fa-spin"></i></span> 次
                            </span>
                            <!-- 不蒜子统计 end -->
                        

                    </div>
                

                </div>
            </div>
        </div>      
    </div>

    
</header>

<script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.12"></script>
<script>
    var boxObj = document.getElementById('words');
    if (boxObj) {
        new Typed(boxObj,{
        strings: ['Whiskeyi&#39;s Blog'],
        typeSpeed: 160,
        startDelay: 100,
        loop: false,
        loopCount: Infinity,
        cursorChar: '|' // 
        });
    }
 </script>


    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">ZHUCHJ</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <!-- Known Issue, found by Hux:
            <nav>'s height woule be hold on by its content.
            so, when navbar scale out, the <nav> will cover tags.
            also mask any touch event of tags, unfortunately.
        -->
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">首页</a>
                    </li>

                    

                        
                    

                        
                        <li>
                            <a href="/about/">关于</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/archive/">归档</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/categories/">分类</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/tags/">标签</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/photography/">摄影</a>
                        </li>
                        
                    
                    
                </ul>
            </div>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>
<script>
    // Drop Bootstarp low-performance Navbar
    // Use customize navbar with high-quality material design animation
    // in high-perf jank-free CSS3 implementation
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        // CLOSE
            $navbar.className = " ";
            // wait until animation end.
            setTimeout(function(){
                // prevent frequently toggle
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        // OPEN
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>


    <!-- Main Content -->
    <!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

            <!-- Post Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                <h1 id="React19-新功能"><a href="#React19-新功能" class="headerlink" title="React19 新功能"></a>React19 新功能</h1><h2 id="React-Compiler"><a href="#React-Compiler" class="headerlink" title="React Compiler"></a><strong>React Compiler</strong></h2><p>React19 最大的热度是支持使用 React Compiler。<br>比如经常看到这样的文章名：震惊！再也不用写 React.memo、useCallback、useMemo 了。</p>
<h3 id="为什么取名为-React-Compiler（编译器）"><a href="#为什么取名为-React-Compiler（编译器）" class="headerlink" title="为什么取名为 React Compiler（编译器）"></a><strong>为什么取名为 React Compiler（编译器）</strong></h3><p>其实 React Compiler 原名是 React Forget（由黄玄在 React Conf 2021 介绍）。<br>Compiler 定义上指的是对 React 代码进行分析并生成不同但功能等效的代码的程序。</p>
<h3 id="React-Compiler-诞生背景"><a href="#React-Compiler-诞生背景" class="headerlink" title="React Compiler 诞生背景"></a><strong>React Compiler 诞生背景</strong></h3><p>React  中的重新渲染是级联的。每次更改  React  组件中的状态时，都会触发该组件、其内部的每个组件、这些组件内部的组件等的重新渲染，直到组件树的末尾。</p>
<p>一般开发者需要手动告诉 React 哪些组件/函数应该重新渲染/调用来优化重新渲染。但对于一些经验不足的开发者并不一定会关注到或者说正确使用（React.memo、useMemo、useCallback）较难。</p>
<h3 id="什么是-React-Compiler"><a href="#什么是-React-Compiler" class="headerlink" title="什么是 React Compiler"></a><strong>什么是 React Compiler</strong></h3><p>React Compiler 是一款构建时工具（目前以 babel  插件的形式集成在代码中使用，并配套对应的 eslint 插件检测代码转换合法性）。</p>
<p>简单来说，他是在保证渲染无异常下，提升更新性能的工具。React Compiler  目前已在一些生产界面（<a href="http://instagram.com/" target="_blank" rel="noopener">instagram.com</a>）使用。<br>React Compiler 功能是自动记忆代码（类似 useMemo、useCallback、React.memo 效果，但是使用的是低级原语），来减少重复计算和渲染成本等。</p>
<p>React Compiler 的记忆化主要包括以下三种：优化重新渲染、记忆昂贵计算、记忆 effects。</p>
<h4 id="优化重新渲染"><a href="#优化重新渲染" class="headerlink" title="优化重新渲染"></a><strong>优化重新渲染</strong></h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">FriendList</span>(<span class="params">&#123; friends &#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> onlineCount = useFriendOnlineCount();</span><br><span class="line">  <span class="keyword">if</span> (friends.length === <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">NoFriends</span> /&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;span&gt;&#123;onlineCount&#125; online&lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">      &#123;friends.map((friend) =&gt; (</span></span><br><span class="line"><span class="regexp">        &lt;FriendListCard key=&#123;friend.id&#125; friend=&#123;friend&#125; /</span>&gt;</span><br><span class="line">      ))&#125;</span><br><span class="line">      &lt;MessageButton /&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>
<p>上述代码有三个问题：</p>
<ol>
<li>props friends 更新后，<MessageButton />会无意义重新渲染</li>
<li>onlineCount 更新后，<FriendListCard />、<MessageButton />被无意义重新渲染</li>
<li>friends 改变后<FriendListCard />不能复用</li>
</ol>
<p>优化后的代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> MemoizedMessageButton = React.memo(MessageButton);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> FriendList = React.memo(<span class="function">(<span class="params">&#123; friends &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> onlineCount = useFriendOnlineCount();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> renderFriendListCard = React.useCallback(</span><br><span class="line">    (friend) =&gt; <span class="xml"><span class="tag">&lt;<span class="name">FriendListCard</span> <span class="attr">key</span>=<span class="string">&#123;friend.id&#125;</span> <span class="attr">friend</span>=<span class="string">&#123;friend&#125;</span> /&gt;</span></span>,</span><br><span class="line">    []</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> friendList = React.useMemo(</span><br><span class="line">    () =&gt; friends.map(renderFriendListCard),</span><br><span class="line">    [friends, renderFriendListCard]</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (friends.length === <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">NoFriends</span> /&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;span&gt;&#123;onlineCount&#125; online&lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">      &#123;friendList&#125;</span></span><br><span class="line"><span class="regexp">      &lt;MemoizedMessageButton /</span>&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;);</span></span><br></pre></td></tr></table></figure>
<p>可以看到，在优化后代码变得比较混乱，同时给开发者带来了额外的成本和负担</p>
<p><strong>React Compiler 实际编译</strong></p>
<p>我们可以使用在线的代码编译转换工具：<a href="https://playground.react.dev/#N4Igzg9grgTgxgUxALhAMygOzgFwJYSYAEAYjHgpgCYAyeYOAFMEWuZVWEQL4CURwADrEicQgyKEANnkwIAwtEw4iAXiJQwCMhWoB5TDLmKsTXgG5hRInjRFGbXZwB0UygHMcACzWr1ABn4hEWsYBBxYYgAeADkIHQ4uAHoAPksRbisiMIiYYkYs6yiqPAA3FMLrIiiwAAcAQ0wU4GlZBSUcbklDNqikusaKkKrgR0TnAFt62sYHdmp+VRT7SqrqhOo6Bnl6mCoiAGsEAE9VUfmqZzwqLrHqM7ubolTVol5eTOGigFkEMDB6u4EAAhKA4HCEZ5DNZ9ErlLIWYTcEDcIA" target="_blank" rel="noopener">React Compiler Playground</a>，来看 React Compiler 编译后的代码。可以看到 React Compiler  生成的仍然是  JSX，如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">FriendList</span>(<span class="params">t0</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 初始化缓存</span></span><br><span class="line">  <span class="comment">// _c是React Compiler的hook(useMemoCache)，会创建一个可缓存元素的数组，9代表缓存数组长度是9</span></span><br><span class="line">  <span class="keyword">const</span> $ = _c(<span class="number">9</span>);</span><br><span class="line">  <span class="keyword">const</span> &#123; friends &#125; = t0;</span><br><span class="line">  <span class="keyword">const</span> onlineCount = useFriendOnlineCount();</span><br><span class="line">  <span class="comment">/** 缓存NoFriends场景 **/</span></span><br><span class="line">  <span class="keyword">if</span> (friends.length === <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> t1;</span><br><span class="line">    <span class="comment">// symbol.for在不同全局作用于下传入键相同值一定相同，相反与Symbol()</span></span><br><span class="line">    <span class="comment">// $[x]默认值为Symbol.for("react.memo_cache_sentinel")，如果相等说明缓存没有被初始化</span></span><br><span class="line">    <span class="keyword">if</span> ($[<span class="number">0</span>] === <span class="built_in">Symbol</span>.for(<span class="string">"react.memo_cache_sentinel"</span>)) &#123;</span><br><span class="line">      t1 = <span class="xml"><span class="tag">&lt;<span class="name">NoFriends</span> /&gt;</span></span>;</span><br><span class="line">      <span class="comment">// 缓存NoFriends</span></span><br><span class="line">      $[<span class="number">0</span>] = t1;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// 缓存无变化，直接使用缓存值</span></span><br><span class="line">      t1 = $[<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> t1;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/** 缓存onlineCount **/</span></span><br><span class="line">  <span class="keyword">let</span> t1;</span><br><span class="line">  <span class="comment">// 不等于或未初始化，更新缓存</span></span><br><span class="line">  <span class="keyword">if</span> ($[<span class="number">1</span>] !== onlineCount) &#123;</span><br><span class="line">    t1 = <span class="xml"><span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;onlineCount&#125; online<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span>;</span><br><span class="line">    $[<span class="number">1</span>] = onlineCount;</span><br><span class="line">    $[<span class="number">2</span>] = t1;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    t1 = $[<span class="number">2</span>];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/** 缓存friends列表 **/</span></span><br><span class="line">  <span class="keyword">let</span> t2;</span><br><span class="line">  <span class="keyword">if</span> ($[<span class="number">3</span>] !== friends) &#123;</span><br><span class="line">    t2 = friends.map(_temp);</span><br><span class="line">    $[<span class="number">3</span>] = friends;</span><br><span class="line">    $[<span class="number">4</span>] = t2;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    t2 = $[<span class="number">4</span>];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/** 缓存MessageButton **/</span></span><br><span class="line">  <span class="keyword">let</span> t3;</span><br><span class="line">  <span class="keyword">if</span> ($[<span class="number">5</span>] === <span class="built_in">Symbol</span>.for(<span class="string">"react.memo_cache_sentinel"</span>)) &#123;</span><br><span class="line">    t3 = <span class="xml"><span class="tag">&lt;<span class="name">MessageButton</span> /&gt;</span></span>;</span><br><span class="line">    $[<span class="number">5</span>] = t3;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    t3 = $[<span class="number">5</span>];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> t4;</span><br><span class="line">  <span class="comment">/** 组合缓存组件 **/</span></span><br><span class="line">  <span class="keyword">if</span> ($[<span class="number">6</span>] !== t1 || $[<span class="number">7</span>] !== t2) &#123;</span><br><span class="line">    t4 = (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &#123;t1&#125;</span><br><span class="line">        &#123;t2&#125;</span><br><span class="line">        &#123;t3&#125;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">    $[6] = t1;</span></span><br><span class="line"><span class="regexp">    $[7] = t2;</span></span><br><span class="line"><span class="regexp">    $[8] = t4;</span></span><br><span class="line"><span class="regexp">  &#125; else &#123;</span></span><br><span class="line"><span class="regexp">    t4 = $[8];</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">  return t4;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp">function _temp(friend) &#123;</span></span><br><span class="line"><span class="regexp">  return &lt;FriendListCard key=&#123;friend.id&#125; friend=&#123;friend&#125; /</span>&gt;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="记忆昂贵计算"><a href="#记忆昂贵计算" class="headerlink" title="记忆昂贵计算"></a><strong>记忆昂贵计算</strong></h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">expensivelyCalc</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">/* ... */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 此为React Component</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Component</span>(<span class="params">&#123; items &#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> data = expensivelyCalc(items);</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意：React Compiler 只记忆 React 组件和 hooks 且不会在组件和 hooks 间共享</p>
<h4 id="记忆-effects（开放的研究领域）"><a href="#记忆-effects（开放的研究领域）" class="headerlink" title="记忆 effects（开放的研究领域）"></a><strong>记忆 effects（开放的研究领域）</strong></h4><p>当之前以某种方式记忆（手动记忆）的不再以完全相同的方式记忆（引入 React Compiler 后）时，这可能会导致问题。（即将记忆结果作为依赖项用于 useEffect、useLayoutEffect 的 dependency 中，这可能会影响 effect 执行过度/不足/甚至无限循环）</p>
<p>目前，React Compiler 会静态验证自动记忆是否与任何现有的手动记忆相匹配。如果无法证明它们相同，则会安全地跳过该组件或钩子。</p>
<p>因此，在实际开发中建议保留现存的 useMemo()、useCallback()，写新代码时建议不依赖任何 useMemo()、useCallback。</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a><strong>总结</strong></h3><p>React Compiler 建立的基础是 React 组件在相同输入（props）获得相同输出（JSX）。即每个组件都是可独立静态分析的模块，不需要考虑之间的联系。</p>
<p>通过以上分析可以发现 React Compiler 可能会存在一些问题：</p>
<ol>
<li>内存占用。记忆化和缓存通常意味着用内存换取处理能力。如果在应用中处理大量数据，可能需要注意关注设备内存情况。</li>
<li>调试问题。编译是编写代码和实际运行代码的一个抽象，在 React Compiler 编译后会让我们的代码调试成本提升（需要充分了解 React Compiler 工作原理）。</li>
</ol>
<p>同时 React Compiler 团队应该处理好性能优化和破坏性变更之间的平衡。就前所述，一些场景会跳过该组件或钩子，以保证原来代码的正确执行。程序员 Nadia Makarevich 有做过性能提升相关测试（详情可见<a href="https://www.developerway.com/posts/i-tried-react-compiler" target="_blank" rel="noopener">文章</a>），React Compiler 实际在性能优化上表现比较保守。</p>
<p>如果你想了解更多 React Compiler 相关的信息可以观看<a href="https://www.youtube.com/watch?v=PYHBHK37xlE" target="_blank" rel="noopener">视频</a>。</p>
<h2 id="New-Features"><a href="#New-Features" class="headerlink" title="New Features"></a><strong>New Features</strong></h2><h3 id="Client-API"><a href="#Client-API" class="headerlink" title="Client API"></a><strong>Client API</strong></h3><p><strong>Actions</strong></p>
<p>Client API 主要在引入 Actions（使用 async transitions 的方法）概念，核心场景是异步表单提交</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Before</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">UpdateName</span>(<span class="params">&#123;&#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [name, setName] = useState(<span class="string">""</span>);</span><br><span class="line">  <span class="keyword">const</span> [error, setError] = useState(<span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">const</span> [isPending, setIsPending] = useState(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> handleSubmit = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    setIsPending(<span class="literal">true</span>);</span><br><span class="line">    <span class="keyword">const</span> error = <span class="keyword">await</span> updateName(name);</span><br><span class="line">    setIsPending(<span class="literal">false</span>);</span><br><span class="line">    <span class="keyword">if</span> (error) &#123;</span><br><span class="line">      setError(error);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    redirect(<span class="string">"/path"</span>);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;input value=&#123;name&#125; onChange=&#123;(event) =&gt; setName(event.target.value)&#125; /&gt;</span><br><span class="line">      &lt;button onClick=&#123;handleSubmit&#125; disabled=&#123;isPending&#125;&gt;</span><br><span class="line">        Update</span><br><span class="line">      &lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">      &#123;error &amp;&amp; &lt;p&gt;&#123;error&#125;&lt;/</span>p&gt;&#125;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ After1</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ 使用react18的useTransition和react19的Asynchronous transitions</span></span><br><span class="line"><span class="regexp">function UpdateName(&#123;&#125;) &#123;</span></span><br><span class="line"><span class="regexp">  const [name, setName] = useState("");</span></span><br><span class="line"><span class="regexp">  const [error, setError] = useState(null);</span></span><br><span class="line"><span class="regexp">  const [isPending, startTransition] = useTransition();</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  const handleSubmit = () =&gt; &#123;</span></span><br><span class="line"><span class="regexp">    startTransition(async () =&gt; &#123;</span></span><br><span class="line"><span class="regexp">      const error = await updateName(name);</span></span><br><span class="line"><span class="regexp">      if (error) &#123;</span></span><br><span class="line"><span class="regexp">        setError(error);</span></span><br><span class="line"><span class="regexp">        return;</span></span><br><span class="line"><span class="regexp">      &#125;</span></span><br><span class="line"><span class="regexp">      redirect("/</span>path<span class="string">");</span></span><br><span class="line"><span class="string">    &#125;);</span></span><br><span class="line"><span class="string">  &#125;;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  return (</span></span><br><span class="line"><span class="string">    &lt;div&gt;</span></span><br><span class="line"><span class="string">      &lt;input value=&#123;name&#125; onChange=&#123;(event) =&gt; setName(event.target.value)&#125; /&gt;</span></span><br><span class="line"><span class="string">      &lt;button onClick=&#123;handleSubmit&#125; disabled=&#123;isPending&#125;&gt;</span></span><br><span class="line"><span class="string">        Update</span></span><br><span class="line"><span class="string">      &lt;/button&gt;</span></span><br><span class="line"><span class="string">      &#123;error &amp;&amp; &lt;p&gt;&#123;error&#125;&lt;/p&gt;&#125;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">  );</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// After2</span></span><br><span class="line"><span class="string">// 使用react19的actions和useActionState</span></span><br><span class="line"><span class="string">function ChangeName(&#123; name, setName &#125;) &#123;</span></span><br><span class="line"><span class="string">  const [error, submitAction, isPending] = useActionState(</span></span><br><span class="line"><span class="string">    async (previousState, formData) =&gt; &#123;</span></span><br><span class="line"><span class="string">      const error = await updateName(formData.get("</span>name<span class="string">"));</span></span><br><span class="line"><span class="string">      if (error) &#123;</span></span><br><span class="line"><span class="string">        return error;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">      redirect("</span>/path<span class="string">");</span></span><br><span class="line"><span class="string">      return null;</span></span><br><span class="line"><span class="string">    &#125;,</span></span><br><span class="line"><span class="string">    null</span></span><br><span class="line"><span class="string">  );</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  return (</span></span><br><span class="line"><span class="string">    &lt;form action=&#123;submitAction&#125;&gt;</span></span><br><span class="line"><span class="string">      &lt;input type="</span>text<span class="string">" name="</span>name<span class="string">" /&gt;</span></span><br><span class="line"><span class="string">      &lt;button type="</span>submit<span class="string">" disabled=&#123;isPending&#125;&gt;</span></span><br><span class="line"><span class="string">        Update</span></span><br><span class="line"><span class="string">      &lt;/button&gt;</span></span><br><span class="line"><span class="string">      &#123;error &amp;&amp; &lt;p&gt;&#123;error&#125;&lt;/p&gt;&#125;</span></span><br><span class="line"><span class="string">    &lt;/form&gt;</span></span><br><span class="line"><span class="string">  );</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p><strong>Asynchronous transitions</strong></p>
<p>可以在 startTransition 中使用 async</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">startTransition(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">await</span> updateData();</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>useActionState</strong></p>
<p>新 hook，根据 actions 来更新 state，处理  Actions  的常见情况</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> [state, submitAction, isPending] = useActionState(</span><br><span class="line">  actionFunction,</span><br><span class="line">  initialState</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>action and formAction props</strong></p>
<p>自动管理表单项（inputs、buttons），将 action 整合于表单中</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;form action=&#123;action&#125; &gt;</span><br><span class="line">&lt;button formAction=&#123;action&#125;&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>useFormStatus</strong><br>获取表单 actions 的状态，有点类似 antd 的 const [form] = Form.useForm();</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; data, pending, method, action &#125; = useFormStatus();</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>useOptimistic</strong></p>
<p>在 action 完成前更新 UI，即实现乐观更新（一种用户体验优化策略，常用于客户端应用中，在与服务器交互时立即更新 UI，假设操作会成功，从而提供即时反馈，即使实际的服务器响应可能稍后才到达。如果操作失败，再回滚到之前的状态）</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在updateName请求进行时立即渲染optimisticName。当更新完成或出错时，React将自动切换回currentName值。</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ChangeName</span>(<span class="params">&#123; currentName, onUpdateName &#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [optimisticName, setOptimisticName] = useOptimistic(currentName);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> submitAction = <span class="keyword">async</span> (formData) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> newName = formData.get(<span class="string">"name"</span>);</span><br><span class="line">    setOptimisticName(newName);</span><br><span class="line">    <span class="keyword">const</span> updatedName = <span class="keyword">await</span> updateName(newName);</span><br><span class="line">    onUpdateName(updatedName);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;form action=&#123;submitAction&#125;&gt;</span><br><span class="line">      &lt;p&gt;Your name is: &#123;optimisticName&#125;&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">      &lt;p&gt;</span></span><br><span class="line"><span class="regexp">        &lt;label&gt;Change Name:&lt;/</span>label&gt;</span><br><span class="line">        &lt;input</span><br><span class="line">          type=<span class="string">"text"</span></span><br><span class="line">          name=<span class="string">"name"</span></span><br><span class="line">          disabled=&#123;currentName !== optimisticName&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">      &lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>form&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><strong>其它更新：</strong></p>
<ul>
<li><p><strong>use</strong></p>
<p>非 hook（仅能在 render 中调用，不同于 hook 可以在条件判断中使用），用于消费资源（官方说未来会支持更多资源类型），目前在 react19 可以读 promise 和 context 的值。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// use promise</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Comments</span>(<span class="params">&#123; promise &#125;</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 使用use会等待promise被resolve，在未被resolve前显示suspense</span></span><br><span class="line">  <span class="keyword">const</span> resolvedData = use(promise);</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;resolvedData&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Page</span>(<span class="params">&#123; promise &#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;Suspense fallback=&#123;&lt;div&gt;Loading...&lt;<span class="regexp">/div&gt;&#125;&gt;</span></span><br><span class="line"><span class="regexp">      &lt;Comments promise=&#123;promise&#125; /</span>&gt;</span><br><span class="line">    &lt;<span class="regexp">/Suspense&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ use context</span></span><br><span class="line"><span class="regexp">import ThemeContext from "./</span>ThemeContext<span class="string">";</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">function Heading(&#123; children &#125;) &#123;</span></span><br><span class="line"><span class="string">  if (children == null) &#123;</span></span><br><span class="line"><span class="string">    return null;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  // useContext在前置返回时异常</span></span><br><span class="line"><span class="string">  const theme = use(ThemeContext);</span></span><br><span class="line"><span class="string">  return &lt;h1 style=&#123;&#123; color: theme.color &#125;&#125;&gt;&#123;children&#125;&lt;/h1&gt;;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Preloading APIs</strong></p>
<p>支持加载和预加载浏览器资源</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// From</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Component</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  preinit(<span class="string">"https://.../script.js"</span>, &#123; <span class="attr">as</span>: <span class="string">"script"</span> &#125;);</span><br><span class="line">  preload(<span class="string">"https://.../stylesheet.css"</span>, &#123; <span class="attr">as</span>: <span class="string">"style"</span> &#125;);</span><br><span class="line">  prefetchDNS(<span class="string">"https://../"</span>);</span><br><span class="line">  preconnect(<span class="string">"https://.../"</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// To</span></span><br><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;link ref=<span class="string">"prefetch-dns"</span> href=<span class="string">"https://..."</span> /&gt;</span><br><span class="line">  &lt;link ref=<span class="string">"preconnect"</span> href=<span class="string">"https://..."</span> /&gt;</span><br><span class="line">  &lt;link ref=<span class="string">"preload"</span> <span class="keyword">as</span>=<span class="string">"font"</span> href=<span class="string">"https://.../font.woff"</span> /&gt;</span><br><span class="line">  &lt;script <span class="keyword">async</span>=<span class="string">""</span> src=<span class="string">"http://.../script.js"</span>&gt;&lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>head&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="Improvements-改进"><a href="#Improvements-改进" class="headerlink" title="Improvements(改进)"></a><strong>Improvements(改进)</strong></h3><ul>
<li><p><strong>ref as a props</strong></p>
<p>使用 ref 作为函数式组件的 props，未来将废除移除 forwardRef</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Before</span></span><br><span class="line"><span class="keyword">import</span> &#123; forwardRef &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">const</span> Input = forwardRef(<span class="function">(<span class="params">props, ref</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">ref</span>=<span class="string">&#123;ref&#125;</span> <span class="attr">...</span> /&gt;</span></span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// After</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Input</span>(<span class="params">&#123; ref &#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">ref</span>=<span class="string">&#123;ref&#125;</span> <span class="attr">...</span> /&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 可以支持一些事件监听等，来优化内存</span></span><br><span class="line">&lt;div</span><br><span class="line">  ref=&#123;ref =&gt; &#123;</span><br><span class="line">    ...</span><br><span class="line">    retrun () =&gt; &#123;</span><br><span class="line">      ref.removeEventHandler(<span class="string">'change'</span>, handleInputChange)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;&#125;</span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Document metadata &amp; Stylesheet support</strong></p>
<p>能够在组件中使用文档 metadata 的标签或者渲染样式表（stylesheet）</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// From</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">BlogPost</span>(<span class="params">&#123; post &#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;title&gt;&#123;post.title&#125;&lt;<span class="regexp">/title&gt;</span></span><br><span class="line"><span class="regexp">    &lt;meta name="author" content=&#123;post.author&#125; /</span>&gt;</span><br><span class="line">    &lt;meta property=<span class="string">"og:image"</span> content=&#123;post.image&#125; /&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// To</span></span><br><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;title&gt;xxx&lt;<span class="regexp">/title&gt;</span></span><br><span class="line"><span class="regexp">    &lt;meta name="author" content="xxx" /</span>&gt;</span><br><span class="line">    &lt;meta name=<span class="string">"og:image"</span> content=<span class="string">"xxx"</span> /&gt;</span><br><span class="line">  &lt;<span class="regexp">/head&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>html&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// From</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Component</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;link rel=<span class="string">"stylesheet"</span> href=<span class="string">"/styles/styles.css"</span> precedence=<span class="string">"default"</span> /&gt;</span><br><span class="line">      &lt;link rel=<span class="string">"stylesheet"</span> href=<span class="string">"/styles/button.css"</span> precedence=<span class="string">"default"</span> /&gt;</span><br><span class="line">      &lt;link rel=<span class="string">"stylesheet"</span> href=<span class="string">"/styles/article.css"</span> precedence=<span class="string">"high"</span> /&gt;</span><br><span class="line">      &lt;article&gt;...&lt;<span class="regexp">/article&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// To</span></span><br><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;link ref=<span class="string">"stylesheet"</span> href=<span class="string">"/style/styles.css"</span> /&gt;</span><br><span class="line">    ...</span><br><span class="line">  &lt;<span class="regexp">/head&gt;</span></span><br><span class="line"><span class="regexp">  &lt;body&gt;</span></span><br><span class="line"><span class="regexp">    &lt;div&gt;</span></span><br><span class="line"><span class="regexp">      &lt;article&gt;...&lt;/</span>article&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>body&gt;</span><br><span class="line">&lt;<span class="regexp">/html&gt;;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="Server-API（略）"><a href="#Server-API（略）" class="headerlink" title="Server API（略）"></a><strong>Server API（略）</strong></h3><ul>
<li><strong>React Server Component</strong></li>
<li><strong>Server Actions</strong></li>
</ul>
<h2 id="React19-总结"><a href="#React19-总结" class="headerlink" title="React19 总结"></a><strong>React19 总结</strong></h2><p>React19 的新主要体现在：</p>
<ul>
<li>useMemo, useCallback, memo -&gt; React Compiler</li>
<li>forwardRef -&gt; ref is a prop</li>
<li>useContext -&gt; use(Context)</li>
<li>throw promise -&gt; use(promise)</li>
<li>…</li>
</ul>
<p>React19 开始支持 React Compiler，主要用于性能优化方面，它有很大的价值，但还有较长的路要走。</p>
<p>React19 围绕“Actions”和“html <head>”等新增了一些 API 来增加开发者的便利。</p>
<p>React19 实际上调整的并不只有这些，如果想要了解 React19 更多内容可以阅读<a href="https://19.react.dev/blog/2024/04/25/react-19" target="_blank" rel="noopener">官方文章</a>或者观看<a href="https://19.react.dev/blog/2024/05/22/react-conf-2024-recap" target="_blank" rel="noopener">React Conf(2024)</a>视频。</p>
<h1 id="项目-React-大版本升级之路"><a href="#项目-React-大版本升级之路" class="headerlink" title="项目 React 大版本升级之路"></a><strong>项目 React 大版本升级之路</strong></h1><h2 id="React-各版本情况"><a href="#React-各版本情况" class="headerlink" title="React 各版本情况"></a><strong>React 各版本情况</strong></h2><p>目前 React 最新的版本是 React19 RC，最新的正式版是 React 18.3.1。</p>
<p>这里科普一下 React 的一些版本别名：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th><strong>版本别名</strong></th>
<th><strong>解释</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>RC</td>
<td>Release Candidate 版本，即发行候选版</td>
</tr>
<tr>
<td>Canary</td>
<td>来源于煤矿中用于检测有毒气体的金丝雀，引申意为早期预警系统，即实验性版本</td>
</tr>
</tbody>
</table>
</div>
<p><strong>NPM 下载量参考（2024.08.12 数据）：</strong><br><a href="https://www.npmjs.com/package/react?activeTab=versions" target="_blank" rel="noopener">https://www.npmjs.com/package/react?activeTab=versions</a></p>
<p>这里截取了16、17、18、19最受欢迎的三个版本下载量，可以看到React最新的正式版18.3.1是当下最受欢迎的版本，3、4年前的17.0.2和16.14.0仍有很大的使用量（即现有近一半的项目使用的是React18以下的版本）。</p>
<p><img src="../img/react19/npmdownload.jpg" /></p>
<h2 id="选择什么版本升级？"><a href="#选择什么版本升级？" class="headerlink" title="选择什么版本升级？"></a><strong>选择什么版本升级？</strong></h2><p>在选择具体版本前需要对 React 和其各版本有一定宏观的了解。</p>
<p><strong>React 状态更新和渲染主要是以下模块实现的：</strong></p>
<ul>
<li>Reconciler（协调器）：处理虚拟 DOM 与实际 DOM 之间的差异(diff)，以确保页面上的元素与虚拟 DOM 的状态保持一致。</li>
<li>Renderer（渲染器）：负责将虚拟 DOM 渲染替换成实际的 DOM，即将 UI 渲染到宿主环境（ReactDOM、ReactNative、ReactArt）。</li>
<li>Scheduler（调度器）：负责调度任务的执行顺序，确保任务按照优先级和合适的时间顺序进入 Reconciler，以实现最佳的性能和用户体验。（Scheduler 在 React16 引入，独立于 React 库<a href="https://github.com/facebook/react/blob/1fb18e22ae66fdb1dc127347e169e73948778e5a/packages/scheduler/README.md。类似浏览器requestIdleCallbackAPI，但是由于兼容性等考虑React自己实现了一套）" target="_blank" rel="noopener">https://github.com/facebook/react/blob/1fb18e22ae66fdb1dc127347e169e73948778e5a/packages/scheduler/README.md。类似浏览器requestIdleCallbackAPI，但是由于兼容性等考虑React自己实现了一套）</a></li>
</ul>
<h3 id="React15"><a href="#React15" class="headerlink" title="React15"></a><strong>React15</strong></h3><p>无 Scheduler，核心是基于虚拟 DOM 进行高效的 UI 渲染</p>
<p>问题：mount 和 update 时会递归更新子组件，当层级深无法中断，造成卡顿（渲染线程和 JS 线程互斥）。</p>
<h3 id="React16"><a href="#React16" class="headerlink" title="React16"></a><strong>React16</strong></h3><p>引入了 Scheduler，并将<a href="https://legacy.reactjs.org/docs/codebase-overview.html#fiber-reconciler" target="_blank" rel="noopener">Stack Reconciler ⇒ Fiber Reconciler</a>（不可中断递归  ⇒  可中断遍历）</p>
<p>核心是引入了 Fiber 架构（这是后续一切可中断的核心），它允许 React 实现优先级调度，以可中断的方式执行工作，从而达到更好的性能。</p>
<h3 id="React17"><a href="#React17" class="headerlink" title="React17"></a><strong>React17</strong></h3><p>官方称为<a href="https://legacy.reactjs.org/blog/2020/10/20/react-v17.html" target="_blank" rel="noopener">”垫脚石”版本</a>。无新架构调整，更多关注于稳定性和向后兼容。</p>
<h3 id="React18"><a href="#React18" class="headerlink" title="React18"></a><strong>React18</strong></h3><ul>
<li>最主要更新是引入<a href="https://react.dev/blog/2022/03/29/react-v18" target="_blank" rel="noopener">实验性功能并发模式</a>（Concurrent Mode），Concurrent Mode 不是新功能而是个底层设计，将 React 的更新模式从同步不可中断  ⇒  异步可中断。</li>
<li>引入了一些新功能，例如自动批处理（Automatic Batching），可以自动将多个状态更新批量处理为单个重新渲染，从而提高性能。这是一个 breaking change，但是能在一定程度上减少应用 render。</li>
<li>新 hooks：useId、useTransition、useDeferredValue…</li>
<li>…</li>
</ul>
<h3 id="React19"><a href="#React19" class="headerlink" title="React19"></a><strong>React19</strong></h3><p>如前文所述，目前是 RC 版本，未发布正式</p>
<h2 id="版本升级评估"><a href="#版本升级评估" class="headerlink" title="版本升级评估"></a><strong>版本升级评估</strong></h2><p>升级前需要对升级收益和代价进行综合考量，再去判断是否应该升级</p>
<ul>
<li><strong>升级收益:</strong>  评估 React 新版本是否提供了一些需要的新功能或性能改进。</li>
<li><strong>升级代价</strong>:  对现有代码库的影响以及可能需要的迁移工作量。</li>
</ul>
<h2 id="升级收益"><a href="#升级收益" class="headerlink" title="升级收益"></a><strong>升级收益</strong></h2><h3 id="一、性能提升"><a href="#一、性能提升" class="headerlink" title="一、性能提升"></a><strong>一、性能提升</strong></h3><p>升级的收益主要体现在性能提升上，而性能提升主要是 React18 自动批处理（Automatic Batching）和并发模式（Concurrent Mode）带来的。</p>
<p><strong>那么 React18 是怎么带来性能提升的？</strong></p>
<p>这里需要对浏览器原理有一定了解。</p>
<p>首先 JavaScript 引擎是在单线程环境（主线程）中执行的。主线程还负责用户交互、网络事件、计时器、动画以及重排和重绘等等。</p>
<p>单线程需要逐个处理任务，当处理某个任务时，所有其他任务都必须等待。这个时候如果遇到较长的长任务（执行时间超过 50ms 的任务都被称为“<a href="https://web.dev/long-tasks-devtools/#what-are-long-tasks" target="_blank" rel="noopener">长任务</a>”），用户则会产生卡顿（阻塞了一些优先级更高的如用户交互任务执行）。</p>
<p>下面有两个例子，一个是使用 useState 管理状态渲染的长列表；一个使用 useTransition（React18  并发 hook）管理状态渲染的长列表。</p>
<ul>
<li>正常使用 useState 表现：<a href="https://w4zcct.csb.app/" target="_blank" rel="noopener">https://w4zcct.csb.app/</a></li>
</ul>
<p>在 performance 面板中可以看到，每次点击事件都是一个长任务，在点击后有明显阻塞。</p>
<p><img src="../img/react19/prev.jpg" /></p>
<p>React18 引入了一个后台运行的并发渲染器。此渲染器提供了一些方法（useTransition、useDeferredValue）让我们可以将某些渲染标记为非紧急。在非紧急渲染场景下 React 将每  5 ms 返回主线程一次（可用于处理更高优先级的任务，具体处理根据 Scheduler 调度的结果），以查看是否有更重要的任务需要处理，例如用户输入，甚至渲染另一个紧急的 React 组件状态更新。</p>
<ul>
<li>使用 useTransition 的表现：<a href="https://r3shnj.csb.app/%E3%80%82" target="_blank" rel="noopener">https://r3shnj.csb.app/。</a></li>
</ul>
<p>在 performance 面板中可以看到，任务被拆分较多单元，列上并发执行任务增加，阻塞时间明显减少。</p>
<p><img src="../img/react19/new.jpg" /></p>
<p>在阅读一些国外的升级文章也可以看到从 React16 升级到 18（开启自动批处理和并发）性能提升效果不错：</p>
<ol>
<li>纽约时报团队称在<a href="https://open.nytimes.com/enhancing-the-new-york-times-web-performance-with-react-18-d6f91a7c5af8" target="_blank" rel="noopener">从 React16 升级 React18</a>（开启自动批处理和并发）后重新渲染次数减少了一半，INP（用户首次与页面交互(如单击按钮)到此交互在屏幕上可见(即下一次绘制)的时间，衡量页面响应能）分数下降 30%。</li>
<li>Airbnb（爱比迎）团队称从<a href="https://medium.com/airbnb-engineering/how-airbnb-smoothly-upgrades-react-b1d772a565fd" target="_blank" rel="noopener">React16 升级到 React18</a>，有很好的性能提升。</li>
</ol>
<p>React18 同时也<a href="https://github.com/facebook/react/pull/21039" target="_blank" rel="noopener">改进了内存使用</a>：在卸载时清理更多的内部字段，从而减轻应用程序代码中可能存在的未修复内存泄漏的影响。</p>
<p><img src="../img/react19/fix.jpg" /></p>
<h3 id="二、开发相关"><a href="#二、开发相关" class="headerlink" title="二、开发相关"></a><strong>二、开发相关</strong></h3><ul>
<li>无需显示导入 React<ul>
<li>React17 前，JSX 会被 Babel 转换成 React.createElement 函数调用</li>
<li>React17 后，支持自动运行时绑定（Automatic Runtime）</li>
</ul>
</li>
<li>新 hooks：userId、useTransition、useDeferredValue（React18）…</li>
<li>由于类型变更以及一些不合法的方法废弃，可以让整体项目代码可读、可维护性增强</li>
</ul>
<h2 id="升级方案-代价"><a href="#升级方案-代价" class="headerlink" title="升级方案  /  代价"></a><strong>升级方案  /  代价</strong></h2><h3 id="React-团队的渐进升级方案"><a href="#React-团队的渐进升级方案" class="headerlink" title="React 团队的渐进升级方案"></a><strong>React 团队的渐进升级方案</strong></h3><p><strong>旧“渐进升级”（React17）方案</strong></p>
<p>React 各版本的几种模式：</p>
<ol>
<li>Legacy 模式，通过 ReactDOM.render(<App />, rootNode)创建。</li>
<li>Blocking 模式（未开启并发模式，但使用了新特性，如 Automatic Batching），通过 ReactDOM.createBlockingRoot(rootNode).render(<App />)创建。</li>
<li>Concurrent 模式（开启并发模式），通过 ReactDOM.createRoot(rootNode).render(<App />)创建。</li>
</ol>
<p>但是在社区中沟通发现旧“渐进升级”策略并不好：开发者从新架构收益主要由于并发特性（解决 CPU 瓶颈和 I/O 瓶颈），但模式变更影响整个应用，而且应用内也可以互相调用不同的 render 方法。如果将入口文件的 render 方法替换后，会使整个应用模式变更，触发很多并发不兼容的错误。</p>
<p><strong>新“渐进升级”（React18）方案</strong></p>
<p>默认场景使用同步更新，使用并发特性时再开启并发更新。</p>
<p>这对我们带来的好处是如果项目升级了 React18 但未使用并发更新的一些特性时，并不会对原有造成破坏性变更。如以下场景，会根据具体代码来判断运行模式。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> App = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = useState(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> [isPending, startTransition] = useTransition();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> onClick = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 使用并发特性useTransition</span></span><br><span class="line">    startTransition(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 并发更新</span></span><br><span class="line">      updateCount(<span class="function">(<span class="params">count</span>) =&gt;</span> count + <span class="number">1</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> onClickCompare = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 同步更新</span></span><br><span class="line">    updateCount(<span class="function">(<span class="params">count</span>) =&gt;</span> count + <span class="number">1</span>);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">onClick</span>=<span class="string">&#123;onClick&#125;</span>&gt;</span>&#123;count&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="一、配置调整"><a href="#一、配置调整" class="headerlink" title="一、配置调整"></a><strong>一、配置调整</strong></h3><ul>
<li><p>升级 React 相关依赖（如 react、react-dom  等）</p>
<ul>
<li><p>react-dom 导入变更（react18 变更）</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// From</span></span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">"react-dom"</span>;</span><br><span class="line"><span class="comment">// To</span></span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">"react-dom/client"</span>;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>升级 ts 包，包括  @types/react  和  @types/react-dom</p>
<ul>
<li>大概工作量：尝试将我们项目（大型 monorepo，大约 200w code lines）ts 升级后发现近 5000errors 需要处理</li>
<li><p>明显差异：组件 props 的 children 必须明确声明列出（具体详见<a href="https://github.com/DefinitelyTyped/DefinitelyTyped/pull/56210" target="_blank" rel="noopener">https://github.com/DefinitelyTyped/DefinitelyTyped/pull/56210</a> ）</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">interface ButtonProps &#123;</span><br><span class="line">  color: string;</span><br><span class="line">  children?: React.ReactNode;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h3 id="二、调整高版本不兼容的代码"><a href="#二、调整高版本不兼容的代码" class="headerlink" title="二、调整高版本不兼容的代码"></a><strong>二、调整高版本不兼容的代码</strong></h3><p><strong>依赖调整：</strong></p>
<p>需要处理直接或间接使用了 React 但与 React18 不兼容的第三方库，尝试升级新版本（需要保证功能可用），或者使用其它代替方案。</p>
<p><strong>API 调整：</strong></p>
<p>将项目升级到 React 高版本，部分 React API 不在高版本支持。需要对现在代码进行替换。</p>
<p>这里推荐使用官方推荐的自动化迁移工具 Codemods（<a href="https://github.com/reactjs/react-codemod）如移除" target="_blank" rel="noopener">https://github.com/reactjs/react-codemod）如移除</a> string refs 可执行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx codemod@latest react/19/replace-string-ref</span><br></pre></td></tr></table></figure>
<p>这个工具对于前文提到的 ts 类型也同样适用</p>
<ul>
<li><p><strong>ReactDOM.render 和 unmountComponentAtNode</strong></p>
<ul>
<li>移除版本：React19</li>
<li>为什么被废弃？新 api 提供新的渲染模式（并发），并支持了一些新特性</li>
<li><p>解决方案：替换为 createRoot(),render 和 root.unmount()</p>
<p><img src="../img/react19/domRender.jpg" /></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Before</span></span><br><span class="line"><span class="keyword">import</span> &#123; render &#125; <span class="keyword">from</span> <span class="string">"react-dom"</span>;</span><br><span class="line"><span class="keyword">const</span> container = <span class="built_in">document</span>.getElementById(<span class="string">"app"</span>);</span><br><span class="line">render(<span class="xml"><span class="tag">&lt;<span class="name">App</span> <span class="attr">tab</span>=<span class="string">"home"</span> /&gt;</span></span>, container);</span><br><span class="line"></span><br><span class="line"><span class="comment">// After</span></span><br><span class="line"><span class="keyword">import</span> &#123; createRoot &#125; <span class="keyword">from</span> <span class="string">"react-dom/client"</span>;</span><br><span class="line"><span class="keyword">const</span> container = <span class="built_in">document</span>.getElementById(<span class="string">"app"</span>);</span><br><span class="line"><span class="keyword">const</span> root = createRoot(container);</span><br><span class="line">root.render(<span class="xml"><span class="tag">&lt;<span class="name">App</span> <span class="attr">tab</span>=<span class="string">"home"</span> /&gt;</span></span>);</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><strong>componentWillMount</strong></p>
<ul>
<li>为什么被废弃？如果你的应用程序使用  <a href="https://zh-hans.react.dev/reference/react/Sus%E2%80%8B%E2%80%8Bpense" target="_blank" rel="noopener">Suspense</a>等新式的  React  功能时，componentWillMount  不保证组件将被挂载。如果渲染尝试被中止，那么  React  将丢弃正在进行的树，并在下一次尝试期间尝试从头开始构建组件。</li>
<li>解决方案：替换为 componentDimMount 或者 constructor / <a href="https://zh-hans.react.dev/reference/react/Component#unsafe_componentwillmount" target="_blank" rel="noopener">UNSAFE_componentWillMount</a></li>
</ul>
</li>
<li><strong>componentWillReceiveProps</strong><ul>
<li>为什么被废弃？原因同上。</li>
<li>解决方案：替换为 getDerivedStateFromProps、componentDidUpdate  或者将  class  组件重构为使用  React Hooks  的函数式组件。 / <a href="https://zh-hans.react.dev/reference/react/Component#unsafe_componentwillreceiveprops" target="_blank" rel="noopener">UNSAFE_componentWillReceiveProps</a></li>
</ul>
</li>
<li><strong>componentWillUpdate</strong><ul>
<li>为什么被废弃？原因同上。</li>
<li>解决方案：替换为 getSnapshotBeforeUpdate / <a href="https://zh-hans.react.dev/reference/react/Component#unsafe_componentwillupdate" target="_blank" rel="noopener">UNSAFE_componentWillUpdate</a></li>
</ul>
</li>
<li><p><strong>findDomNode</strong></p>
<ul>
<li>移除版本：React19</li>
<li>为什么被废弃？可以返回组件挂载到 dom 上的实例。 JSX  节点与操作相应的  DOM  节点的代码之间的联系不是显式的，因此使用  findDOMNode  的代码非常脆弱</li>
<li><p>解决方案：使用 refs 替代，可以通过 props 传递、Forwarding Refs…</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Before</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyComponent</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  componentDidMount() &#123;</span><br><span class="line">    <span class="keyword">const</span> domNode = ReactDOM.findDOMNode(<span class="keyword">this</span>);</span><br><span class="line">    <span class="comment">// 操作 DOM 节点</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Example<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// After</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyComponent</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">    <span class="keyword">this</span>.myRef = React.createRef();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  componentDidMount() &#123;</span><br><span class="line">    <span class="keyword">const</span> domNode = <span class="keyword">this</span>.myRef.current;</span><br><span class="line">    <span class="comment">// 操作DOM节点</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ref</span>=<span class="string">&#123;this.myRef&#125;</span>&gt;</span>Example<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><strong>String Refs</strong></p>
<ul>
<li>移除版本：React19</li>
<li>为什么被废弃？涉及到全局的字符串命名，影响共享 ref 和可维护性</li>
<li><p>解决方案：使用 React.createRef()替换</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Before</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyComponent</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ref</span>=<span class="string">"myDiv"</span> /&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  componentDidMount() &#123;</span><br><span class="line">    <span class="keyword">const</span> node = <span class="keyword">this</span>.refs.myDiv;</span><br><span class="line">    <span class="comment">// ...可以对DOM节点node做操作</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// After</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyComponent</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">    <span class="keyword">this</span>.myDiv = React.createRef();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ref</span>=<span class="string">&#123;this.myDiv&#125;</span> /&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  componentDidMount() &#123;</span><br><span class="line">    <span class="keyword">const</span> node = <span class="keyword">this</span>.myDiv.current;</span><br><span class="line">    <span class="comment">// ...可以对DOM节点node做操作</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><strong>Legacy Context</strong></p>
<ul>
<li>移除版本：React19</li>
<li>为什么被废弃？容易被误用（如错误传递数据），并且可能导致维护上的问题</li>
<li><p>解决方案：将过时的 apichildContextTypes 和 getChildContext  替换为新的 API React.createContext()</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Before</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyProvider</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  getChildContext() &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">value</span>: <span class="keyword">this</span>.props.value &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.props.children;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">MyProvider.childContextTypes = &#123;</span><br><span class="line">  value: PropTypes.string,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyConsumer</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;this.context.value&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">MyConsumer.contextTypes = &#123;</span><br><span class="line">  value: PropTypes.string,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// After</span></span><br><span class="line"><span class="keyword">const</span> MyContext = React.createContext(defaultValue);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyProvider</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;MyContext.Provider value=&#123;<span class="keyword">this</span>.props.value&#125;&gt;</span><br><span class="line">        &#123;<span class="keyword">this</span>.props.children&#125;</span><br><span class="line">      &lt;<span class="regexp">/MyContext.Provider&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">class MyConsumer extends React.Component &#123;</span></span><br><span class="line"><span class="regexp">  render() &#123;</span></span><br><span class="line"><span class="regexp">    return (</span></span><br><span class="line"><span class="regexp">      &lt;MyContext.Consumer&gt;&#123;(value) =&gt; &lt;div&gt;&#123;value&#125;&lt;/</span>div&gt;&#125;&lt;<span class="regexp">/MyContext.Consumer&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><strong>useRef()和 createContext()需要一个参数</strong></p>
<ul>
<li>变更版本：React19</li>
<li>为什么被变更？能够简化其类型签名。并且改变后所有 ref 都为 mutable，不会遇到无法更改 ref 的问题</li>
<li><p>解决方案：替换为 useRef(undefined)、createContext(undefined)。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// @ts-expect-error: Expected 1 argument but saw none</span></span><br><span class="line">useRef();</span><br><span class="line"><span class="comment">// Passes</span></span><br><span class="line">useRef(<span class="literal">undefined</span>);</span><br><span class="line"><span class="comment">// @ts-expect-error: Expected 1 argument but saw none</span></span><br><span class="line">createContext();</span><br><span class="line"><span class="comment">// Passes</span></span><br><span class="line">createContext(<span class="literal">undefined</span>);</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h3 id="三、兼容性问题"><a href="#三、兼容性问题" class="headerlink" title="三、兼容性问题"></a><strong>三、兼容性问题</strong></h3><p><strong>浏览器兼容</strong></p>
<p>React18 建立在现代浏览器功能之上，并引入了在 IE 中无法通过捆绑全局 polyfill 解决的功能。因此升级到 React18 以上版本将不再支持 IE。</p>
<p><img src="../img/react19/browser.jpg" /></p>
<h3 id="四、测试成本"><a href="#四、测试成本" class="headerlink" title="四、测试成本"></a><strong>四、测试成本</strong></h3><p>如果您项目的 React 版本在 16 并打算升级，那么升级 React 版本收益的核心是享受性能提升。而性能提升意味着需要引入 React18 中的自动批处理（Automatic Batching）和并发模式（Automatic Batching），这在官方描述下属于破坏性变更，所以项目需要尽可能全量回归（如果单次全量不允许，可以像<a href="https://medium.com/airbnb-engineering/how-airbnb-smoothly-upgrades-react-b1d772a565fd" target="_blank" rel="noopener">Airbnb 团队升级 React 版本</a>一样，通过模块别名分割版本来降低单次测试的成本）。</p>
<h2 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a><strong>总结</strong></h2><p>React19 的更新主要是 React Compiler 带来的性能提升和一些便捷开发者的 API。</p>
<p>如果您最近打算升级项目的 React 版本，可以参考文章中的收益和代价综合考量。这里建议将项目的 React 版本升级到 18.3.1（使用人数最多，且收益最大化）。</p>
<p>最后，感谢您能看到这个地方，文章中如有不正确的内容欢迎指出。完结撒花～ 🎉</p>
<p><strong>文章部分内容参考</strong></p>
<blockquote>
<ol>
<li><a href="https://www.youtube.com/watch?v=lGEMwh32soc" target="_blank" rel="noopener">https://www.youtube.com/watch?v=lGEMwh32soc</a></li>
<li><a href="https://www.youtube.com/watch?v=PYHBHK37xlE" target="_blank" rel="noopener">https://www.youtube.com/watch?v=PYHBHK37xlE</a></li>
<li><a href="https://www.youtube.com/watch?v=T8TZQ6k4SLE" target="_blank" rel="noopener">https://www.youtube.com/watch?v=T8TZQ6k4SLE</a></li>
<li><a href="https://github.com/reactwg/react-compiler" target="_blank" rel="noopener">https://github.com/reactwg/react-compiler</a></li>
<li><a href="https://www.developerway.com/posts/i-tried-react-compiler" target="_blank" rel="noopener">https://www.developerway.com/posts/i-tried-react-compiler</a></li>
<li><a href="https://tonyalicea.dev/blog/understanding-react-compiler/" target="_blank" rel="noopener">https://tonyalicea.dev/blog/understanding-react-compiler/</a></li>
<li><a href="https://github.com/facebook/react/blob/main/CHANGELOG.md" target="_blank" rel="noopener">https://github.com/facebook/react/blob/main/CHANGELOG.md</a></li>
<li><a href="https://legacy.reactjs.org/blog" target="_blank" rel="noopener">https://legacy.reactjs.org/blog</a></li>
<li><a href="https://react.dev/blog" target="_blank" rel="noopener">https://react.dev/blog</a></li>
<li><a href="https://vercel.com/blog/how-react-18-improves-application-performance" target="_blank" rel="noopener">https://vercel.com/blog/how-react-18-improves-application-performance</a></li>
<li><a href="https://react.dev/reference/react/legacy" target="_blank" rel="noopener">https://react.dev/reference/react/legacy</a></li>
<li>《React 设计原理》</li>
</ol>
</blockquote>


                <hr>
                <!-- Pager -->
                <ul class="pager">
                    
                    
                    <li class="next">
                        <a href="/unit-test.html" data-toggle="tooltip" data-placement="top" title="Unit Testing">Next Post</a>
                    </li>
                    
                </ul>

                <!-- tip start -->
                

                
                <!-- tip end -->

                <!-- Music start-->
                
                <!-- Music end -->

                <!-- Sharing -->
                
                <!-- Sharing -->

                <!-- gitment start -->
                
                <!-- gitment end -->

                <!-- 来必力City版安装代码 -->
                
                <!-- City版安装代码已完成 -->

                <!-- disqus comment start -->
                
                <!-- disqus comment end -->
            </div>

            <!-- Tabe of Content -->
            <!-- Table of Contents -->

    
      
        <aside id="sidebar">
          <div id="toc" class="toc-article">
          <strong class="toc-title">文章目录：</strong>
          
            
              <ol class="toc-nav"><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#React19-新功能"><span class="toc-nav-number">1.</span> <span class="toc-nav-text">React19 新功能</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#React-Compiler"><span class="toc-nav-number">1.1.</span> <span class="toc-nav-text">React Compiler</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#为什么取名为-React-Compiler（编译器）"><span class="toc-nav-number">1.1.1.</span> <span class="toc-nav-text">为什么取名为 React Compiler（编译器）</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#React-Compiler-诞生背景"><span class="toc-nav-number">1.1.2.</span> <span class="toc-nav-text">React Compiler 诞生背景</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#什么是-React-Compiler"><span class="toc-nav-number">1.1.3.</span> <span class="toc-nav-text">什么是 React Compiler</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#优化重新渲染"><span class="toc-nav-number">1.1.3.1.</span> <span class="toc-nav-text">优化重新渲染</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#记忆昂贵计算"><span class="toc-nav-number">1.1.3.2.</span> <span class="toc-nav-text">记忆昂贵计算</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#记忆-effects（开放的研究领域）"><span class="toc-nav-number">1.1.3.3.</span> <span class="toc-nav-text">记忆 effects（开放的研究领域）</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#总结"><span class="toc-nav-number">1.1.4.</span> <span class="toc-nav-text">总结</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#New-Features"><span class="toc-nav-number">1.2.</span> <span class="toc-nav-text">New Features</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#Client-API"><span class="toc-nav-number">1.2.1.</span> <span class="toc-nav-text">Client API</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#Improvements-改进"><span class="toc-nav-number">1.2.2.</span> <span class="toc-nav-text">Improvements(改进)</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#Server-API（略）"><span class="toc-nav-number">1.2.3.</span> <span class="toc-nav-text">Server API（略）</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#React19-总结"><span class="toc-nav-number">1.3.</span> <span class="toc-nav-text">React19 总结</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#项目-React-大版本升级之路"><span class="toc-nav-number">2.</span> <span class="toc-nav-text">项目 React 大版本升级之路</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#React-各版本情况"><span class="toc-nav-number">2.1.</span> <span class="toc-nav-text">React 各版本情况</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#选择什么版本升级？"><span class="toc-nav-number">2.2.</span> <span class="toc-nav-text">选择什么版本升级？</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#React15"><span class="toc-nav-number">2.2.1.</span> <span class="toc-nav-text">React15</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#React16"><span class="toc-nav-number">2.2.2.</span> <span class="toc-nav-text">React16</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#React17"><span class="toc-nav-number">2.2.3.</span> <span class="toc-nav-text">React17</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#React18"><span class="toc-nav-number">2.2.4.</span> <span class="toc-nav-text">React18</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#React19"><span class="toc-nav-number">2.2.5.</span> <span class="toc-nav-text">React19</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#版本升级评估"><span class="toc-nav-number">2.3.</span> <span class="toc-nav-text">版本升级评估</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#升级收益"><span class="toc-nav-number">2.4.</span> <span class="toc-nav-text">升级收益</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#一、性能提升"><span class="toc-nav-number">2.4.1.</span> <span class="toc-nav-text">一、性能提升</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#二、开发相关"><span class="toc-nav-number">2.4.2.</span> <span class="toc-nav-text">二、开发相关</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#升级方案-代价"><span class="toc-nav-number">2.5.</span> <span class="toc-nav-text">升级方案  &#x2F;  代价</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#React-团队的渐进升级方案"><span class="toc-nav-number">2.5.1.</span> <span class="toc-nav-text">React 团队的渐进升级方案</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#一、配置调整"><span class="toc-nav-number">2.5.2.</span> <span class="toc-nav-text">一、配置调整</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#二、调整高版本不兼容的代码"><span class="toc-nav-number">2.5.3.</span> <span class="toc-nav-text">二、调整高版本不兼容的代码</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#三、兼容性问题"><span class="toc-nav-number">2.5.4.</span> <span class="toc-nav-text">三、兼容性问题</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#四、测试成本"><span class="toc-nav-number">2.5.5.</span> <span class="toc-nav-text">四、测试成本</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#总结-1"><span class="toc-nav-number">2.6.</span> <span class="toc-nav-text">总结</span></a></li></ol></li></ol>
            
          
          </div>
        </aside>
      
    


            <!-- Sidebar Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                

                <!-- Friends Blog -->
                
            </div>
        </div>
    </div>
</article>




<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>
<!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ -->
<script>
    async("https://cdn.bootcss.com/anchor-js/1.1.1/anchor.min.js",function(){
        anchors.options = {
          visible: 'hover',
          placement: 'left',
          icon: '♯'
        };
        anchors.add().remove('.intro-header h1').remove('.subheading').remove('.sidebar-container h5');
    })
</script>


<style  type="text/css">
    /* place left on bigger screen */
    @media all and (min-width: 800px) {
        .anchorjs-link{
            position: absolute;
            left: -0.75em;
            font-size: 1.1em;
            margin-top : -0.1em;
        }
    }
</style>



    <!-- Footer -->
    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                
                
                    <li>
                        <a target="_blank"  href="tencent://message/?Menu=yes&uin=825906196">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-qq fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                
                    <li>
                        <a class="social weixin"  href="javascript:">  
                           <!-- javascript:表示标签作为按钮使用，不做跳转，实现url访问拦截。 -->
                            <img class="qrcode" src="img/wechat.png" alt="微信二维码">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-wechat fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                
                    <li>
                        <a target="_blank"  href="https://github.com/Whiskeyi">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                
                    <li>
                        <a target="_blank"  href="mailto:zhuchjie@gmail.com">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                

                

                

                

                

                

                </ul>
                <p class="copyright text-muted text-center">
                    Copyright &copy;
                    <a href="https://zhuchj.com">
                        <i>zhuchj</i>
                    </a>|
                    2020-2023
                    All Rights Reserved.
                    <br>
                    备案号：浙ICP备2020041949号-1|
                    <iframe name="star" style="margin-left: 2px; margin-bottom:-5px;" frameborder="0" scrolling="0"
                        width="60px" height="20px"
                        src="https://ghbtns.com/github-btn.html?user=Whiskeyi&repo=Whiskeyi.github.io&type=star">
                    </iframe>
                </p>
            </div>
        </div>
    </div>

</footer>

<!-- jQuery -->

<script src="/js/jquery.min.js"></script>


<!-- Bootstrap Core JavaScript -->

<script src="/js/bootstrap.min.js"></script>


<!-- Custom Theme JavaScript -->

<script src="/js/hux-blog.min.js"></script>


<!-- Search -->

<script src="/js/search.js"></script>


<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>


<!-- jquery.tagcloud.js -->
<script>
    // only load tagcloud.js in tag.html
    if($('#tag_cloud').length !== 0){
        async("https://zhuchj.com/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                //size: {start: 1, end: 1, unit: 'em'},
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>

<!--fastClick.js -->
<script>
    async("https://cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>


<!-- Google Analytics -->


<script>
    // dynamic User by Hux
    var _gaId = 'UA-XXXXXXXX-X';
    var _gaDomain = 'yoursite';

    // Originial
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', _gaId, _gaDomain);
    ga('send', 'pageview');
</script>




<!-- Baidu Tongji -->


<!-- Search -->

    <script type="text/javascript">      
        var search_path = "search.xml";
        if (search_path.length == 0) {
            search_path = "search.xml";
        }
    var path = "/" + search_path;
    searchFunc(path, 'local-search-input', 'local-search-result');
    </script>


<!-- busuanzi -->
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>






	<a id="rocket" href="#top" class=""></a>
	<script type="text/javascript" src="/js/totop.js?v=1.0.0" async=""></script>
    <script type="text/javascript" src="/js/toc.js?v=1.0.0" async=""></script>

    

    <!--<script size="50" alpha='0.3' zIndex="-999" src="/js/ribbonStatic.js"></script>-->
    
        <script src="/js/ribbonDynamic.js"></script>
    
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</body>

</html>
